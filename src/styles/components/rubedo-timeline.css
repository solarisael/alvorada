@reference "tailwindcss";
@reference "../utils.css";

.rubedo-timeline-page {
  --rubedo_timeline_panel_border: color-mix(
    in oklch,
    var(--site_style_accent) 36%,
    transparent
  );
  --rubedo_timeline_panel_surface: color-mix(
    in oklch,
    var(--ui_surface_raised) 38%,
    transparent
  );
  --rubedo_timeline_node_glow: color-mix(
    in oklch,
    var(--site_style_accent) 72%,
    transparent
  );
  --rubedo_timeline_node_dim: color-mix(
    in oklch,
    var(--site_style_accent) 32%,
    transparent
  );
  --rubedo_timeline_node_fog: color-mix(
    in oklch,
    var(--site_style_accent) 24%,
    transparent
  );
  --rubedo_timeline_node_reliquary_ring: color-mix(
    in oklch,
    var(--site_style_accent) 64%,
    transparent
  );
  --rubedo_timeline_node_reliquary_edge: color-mix(
    in oklch,
    white 76%,
    var(--site_style_accent)
  );
}

.rubedo-timeline-header {
  @apply mb-4;
}

.rubedo-timeline-grid {
  @apply mt-6 grid gap-4;

  grid-template-columns: 1fr;
  grid-template-areas:
    "filters"
    "map"
    "state_lane";
}

.rubedo-timeline-grid > section {
  @apply rounded-2xl p-4;

  border: 1px solid var(--rubedo_timeline_panel_border);
  background: linear-gradient(
    154deg,
    var(--rubedo_timeline_panel_surface),
    color-mix(in oklch, var(--ui_bg_crust) 44%, transparent)
  );
  box-shadow:
    inset 0 0 0 1px
      color-mix(in oklch, var(--site_style_accent) 12%, transparent),
    0 1.1rem 2.4rem -1.8rem rgb(0 0 0 / 0.84);
}

.rubedo-timeline-panel-column {
  @apply flex flex-col gap-4;
}

.rubedo-timeline-state-panel {
  @apply flex flex-col gap-4;
}

.rubedo-timeline-state-panel-body {
  @apply flex flex-col gap-4;
}

.rubedo-timeline-map-card {
  grid-area: map;
}

.rubedo-timeline-filters-card {
  grid-area: filters;
}

.rubedo-timeline-state-lane-card {
  @apply flex flex-col gap-2;

  grid-area: state_lane;
}

.rubedo-timeline-preview-action {
  @apply mt-auto pt-4;
}

.rubedo-timeline-go-to-chapter {
  @apply inline-flex rounded-lg px-3 py-1.5;

  border: 1px solid
    color-mix(in oklch, var(--site_style_accent) 32%, transparent);
  background: color-mix(in oklch, var(--site_style_accent) 18%, transparent);
}

.rubedo-timeline-panel-card {
  @apply rounded-2xl p-4;

  border: 1px solid var(--rubedo_timeline_panel_border);
  background: linear-gradient(
    154deg,
    var(--rubedo_timeline_panel_surface),
    color-mix(in oklch, var(--ui_bg_crust) 44%, transparent)
  );
  box-shadow:
    inset 0 0 0 1px
      color-mix(in oklch, var(--site_style_accent) 12%, transparent),
    0 1.1rem 2.4rem -1.8rem rgb(0 0 0 / 0.84);
}

.rubedo-timeline-controls {
  @apply mt-3 flex flex-col gap-3;
}

.rubedo-timeline-controls span {
  @apply text-xs uppercase;

  letter-spacing: 0.08em;
}

.rubedo-timeline-controls label {
  @apply flex flex-col gap-1;
}

.rubedo-timeline-controls select {
  @apply rounded-md px-2 py-1;

  border: 1px solid
    color-mix(in oklch, var(--site_style_accent) 28%, transparent);
  background: color-mix(in oklch, var(--ui_bg_mantle) 54%, transparent);
}

@media (min-width: 52rem) {
  .rubedo-timeline-controls {
    @apply grid gap-3;

    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

.rubedo-timeline-legend {
  @apply mt-3 flex flex-col gap-1;
}

.rubedo-constellation {
  @apply relative rounded-xl p-2;

  border: 1px solid
    color-mix(in oklch, var(--site_style_accent) 22%, transparent);
  background:
    radial-gradient(
      132% 92% at 50% -6%,
      color-mix(in oklch, var(--site_style_accent) 24%, transparent),
      transparent 66%
    ),
    linear-gradient(
      180deg,
      color-mix(in oklch, var(--ui_surface_soft) 26%, transparent),
      color-mix(in oklch, var(--ui_bg_mantle) 46%, transparent)
    );
}

.rubedo-constellation-controls {
  @apply absolute top-3 right-3 z-20 inline-flex items-center gap-2 rounded-lg px-2 py-1;

  border: 1px solid
    color-mix(in oklch, var(--site_style_accent) 32%, transparent);
  background: color-mix(in oklch, var(--ui_bg_mantle) 72%, transparent);
}

.rubedo-constellation-controls button {
  @apply rounded px-2 py-1 text-xs;

  border: 1px solid
    color-mix(in oklch, var(--site_style_accent) 30%, transparent);
  background: color-mix(in oklch, var(--site_style_accent) 14%, transparent);
}

.rubedo-constellation-controls input[type="range"] {
  width: 7.5rem;
}

.rubedo-constellation-zoom-badge {
  @apply rounded px-2 py-0.5 text-[0.62rem] uppercase;

  letter-spacing: 0.08em;
  border: 1px solid
    color-mix(in oklch, var(--site_style_accent) 36%, transparent);
  background: color-mix(in oklch, var(--site_style_accent) 22%, transparent);
  opacity: 0;
  transform: translateY(-0.15rem);
  transition:
    opacity 180ms ease,
    transform 220ms ease;
}

.rubedo-constellation-zoom-badge.is-active {
  opacity: 1;
  transform: translateY(0);
}

.rubedo-constellation-node-label {
  @apply pointer-events-none absolute;

  color: color-mix(in oklch, var(--site_style_accent) 52%, white);
  font-size: 0.64rem;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  line-height: 1;
  white-space: nowrap;
  opacity: 0;
  transform: translate(-50%, calc(-100% - 0.5rem)) translateY(0.35rem);
  filter: drop-shadow(0 0 8px rgb(255 255 255 / 0.18));
  transition:
    opacity 260ms ease,
    transform 340ms ease,
    filter 320ms ease;
}

.rubedo-constellation-node-label.is-visible,
.rubedo-constellation-node-label.is-active {
  opacity: 1;
  transform: translate(-50%, calc(-100% - 0.5rem)) translateY(0);
  filter: drop-shadow(0 0 10px rgb(255 255 255 / 0.6))
    drop-shadow(
      0 0 22px color-mix(in oklch, var(--site_style_accent) 38%, transparent)
    );
}

.rubedo-constellation-canvas-surface {
  @apply w-full;

  display: block;
  min-height: 70vh;
  max-height: 92vh;
  cursor: grab;
  outline: none;
}

.rubedo-constellation-label-overlay {
  @apply pointer-events-none absolute;

  inset: 0;
}

.rubedo-constellation-hover-preview-layer {
  @apply absolute z-30;

  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  pointer-events: none;
}

.rubedo-timeline-hover-preview {
  @apply absolute rounded-xl p-3;

  left: 1rem;
  top: 1rem;
  width: min(22rem, calc(100% - 2rem));
  border: 1px solid
    color-mix(in oklch, var(--site_style_accent) 34%, transparent);
  background: linear-gradient(
    160deg,
    color-mix(in oklch, var(--ui_bg_mantle) 86%, transparent),
    color-mix(in oklch, var(--ui_bg_crust) 78%, transparent)
  );
  box-shadow:
    inset 0 0 0 1px
      color-mix(in oklch, var(--site_style_accent) 10%, transparent),
    0 1.2rem 2.8rem -1.8rem rgb(0 0 0 / 0.88);
  opacity: 0;
  transform: translateY(0.6rem) scale(0.985);
  transition:
    opacity 220ms ease,
    transform 260ms ease;
  pointer-events: none;
}

.rubedo-timeline-hover-preview.is-visible {
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}

.rubedo-timeline-hover-preview h3 {
  @apply text-sm uppercase;

  letter-spacing: 0.08em;
}

.rubedo-timeline-hover-preview p {
  @apply text-sm;
}

.rubedo-timeline-fallback-badge {
  @apply rounded-md px-2 py-0.5;

  border: 1px solid
    color-mix(in oklch, var(--site_style_accent) 22%, transparent);
}

.rubedo-timeline-fallback-badge[data-fallback-state="exact"] {
  background: color-mix(in oklch, var(--site_style_accent) 24%, transparent);
}

.rubedo-timeline-fallback-badge[data-fallback-state="thread_core_fallback"] {
  background: color-mix(in oklch, var(--color-citrinitas) 28%, transparent);
}

.rubedo-timeline-fallback-badge[data-fallback-state="cinza_core_fallback"] {
  background: color-mix(in oklch, var(--color-rubedo) 24%, transparent);
}

@media (min-width: 64rem) {
  .rubedo-timeline-grid {
    grid-template-columns: 1fr;
    grid-template-areas:
      "filters filters"
      "map map"
      "state_lane state_lane";
    align-items: start;
  }
}
